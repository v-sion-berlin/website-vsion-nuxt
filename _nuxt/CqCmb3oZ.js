import{u as y,c as f,g,a as v,b as w,d as I,e as b,f as E}from"./1vPF4Y_T.js";import"./Bt5P45U8.js";import{$ as s,l as h,m as _}from"#entry";import{c as p}from"./hoZb054c.js";import{d as x}from"./DuAV58dt.js";import"./kl368zJc.js";import"./CMP1ebxt.js";const D="http",R=c=>{const r=(e="")=>h(c.base,e.replace(/:/g,"/")),n=(e="")=>h(c.base,(e||"/").replace(/:/g,"/"),":"),u=(e,t=null)=>{if(e?.response?.status===404)return t;throw e},a=(e,t)=>{const o={...t,...c.headers,...e?.headers};return e?.ttl&&!o["x-ttl"]&&(o["x-ttl"]=e.ttl+""),o};return{name:D,options:c,hasItem(e,t){return s(r(e),{method:"HEAD",headers:a(t)}).then(()=>!0).catch(o=>u(o,!1))},async getItem(e,t){return await s(r(e),{headers:a(t)}).catch(u)},async getItemRaw(e,t){return(await s.raw(r(e),{responseType:"arrayBuffer",headers:a(t,{accept:"application/octet-stream"})}).catch(u))._data},async getMeta(e,t){const o=await s.raw(r(e),{method:"HEAD",headers:a(t)});let i,d;const m=o.headers.get("last-modified");m&&(i=new Date(m));const l=o.headers.get("x-ttl");return l&&(d=Number.parseInt(l,10)),{status:o.status,mtime:i,ttl:d}},async setItem(e,t,o){await s(r(e),{method:"PUT",body:t,headers:a(o)})},async setItemRaw(e,t,o){await s(r(e),{method:"PUT",body:t,headers:a(o,{"content-type":"application/octet-stream"})})},async removeItem(e,t){await s(r(e),{method:"DELETE",headers:a(t)})},async getKeys(e,t){const o=await s(n(e),{headers:a(t)});return Array.isArray(o)?o:[]},async clear(e,t){await s(n(e),{method:"DELETE",headers:a(t)})}}};function B(c,r){const n=y(c,r);if(!_().public.studio.dev)return n;n.meta.dev=!0;const u=f({driver:R({base:"/__nuxt_studio/dev/content"})});return n.app.requestRerender=()=>{},n.document.db.upsert=x(async(a,e)=>{const t=g(a,p);if(!t)throw new Error(`Collection not found for fsPath: ${a}`);const o=v(a,t),i=w(o,t,e),d=await n.document.generate.contentFromDocument(i);await $fetch("/__nuxt_studio/dev/content/"+a,{method:"PUT",body:d,headers:{"content-type":"text/plain"},timeout:100}).catch(()=>{})},100),n.document.db.delete=async a=>{await u.removeItem(a)},n.on.documentUpdate=a=>{(void 0).on("nuxt-content:update",e=>{const t=I(e.key,p),o=b(e.key,t.source),i=E(e.key,o),d=e.queries.length===0;a(i,d?"remove":"update")})},n.on.mediaUpdate=a=>{(void 0).on("nuxt-studio:media:update",e=>{a(e.id,e.type)})},n}export{B as useStudioHost};
